{% extends "accounts/base.html" %}

{% block title %}Accueil - Kallam{% endblock %}
{% block body_class %}x-theme app-page{% endblock %}

{% block content %}
<section class="app-shell">
  <aside class="left-rail">
    <div class="rail-card">
      <h2>Kallam</h2>
      <nav class="rail-nav">
        <a class="active" href="{% url 'accounts:home' %}">Accueil</a>
        <a href="#">Explorer</a>
        <a href="#">Messages</a>
        <a href="#">Profil</a>
      </nav>
      <form method="post" action="{% url 'accounts:logout' %}">
        {% csrf_token %}
        <button type="submit" class="primary rail-button">Deconnexion</button>
      </form>
    </div>
  </aside>

  <section class="timeline">
    <header class="timeline-header">
      <h1>Accueil</h1>
    </header>

    <section class="composer">
      <h3>Publier</h3>
      <form method="post" class="composer-form" data-composer-form>
        {% csrf_token %}
        {{ post_form.content }}
        {% if post_form.content.errors %}
          <small class="error">{{ post_form.content.errors|striptags }}</small>
        {% endif %}
        <div class="composer-footer">
          <small class="muted">280 caracteres max</small>
          <small class="muted" data-char-count>0/280</small>
          <button class="primary" type="submit" data-publish-btn>Publier</button>
        </div>
      </form>
    </section>

    {% if posts %}
      {% for post in posts %}
        <article class="tweet-card" id="post-{{ post.id }}">
          <p class="tweet-author">
            {{ post.author_display_name }}
            <span>{{ post.author_handle }}</span>
            <span>Â·</span>
            <span>{{ post.created_at|timesince }}</span>
          </p>
          <p class="tweet-text">{{ post.content }}</p>
          <div class="tweet-actions">
            <button
              type="button"
              class="action-btn reply-btn"
              data-reply-handle="{{ post.author_handle }}"
            >
              Repondre
            </button>

            <form method="post" action="{% url 'accounts:post_action' post.id 'repost' %}" class="inline-form">
              {% csrf_token %}
              <input type="hidden" name="next" value="{% url 'accounts:home' %}#post-{{ post.id }}">
              <button
                type="submit"
                class="action-btn {% if post.reposted_by_me %}is-active{% endif %}"
              >
                Reposter {% if post.repost_count %}{{ post.repost_count }}{% endif %}
              </button>
            </form>

            <form method="post" action="{% url 'accounts:post_action' post.id 'like' %}" class="inline-form">
              {% csrf_token %}
              <input type="hidden" name="next" value="{% url 'accounts:home' %}#post-{{ post.id }}">
              <button
                type="submit"
                class="action-btn {% if post.liked_by_me %}is-active{% endif %}"
              >
                Aimer {% if post.like_count %}{{ post.like_count }}{% endif %}
              </button>
            </form>

            <form method="post" action="{% url 'accounts:post_action' post.id 'report' %}" class="inline-form">
              {% csrf_token %}
              <input type="hidden" name="next" value="{% url 'accounts:home' %}#post-{{ post.id }}">
              <button
                type="submit"
                class="action-btn report-btn {% if post.reported_by_me %}is-reported{% endif %}"
              >
                {% if post.reported_by_me %}Reporte{% else %}Reporter{% endif %}
              </button>
            </form>
          </div>
        </article>
      {% endfor %}
    {% else %}
      <article class="tweet-card empty-feed">
        <p class="tweet-text">Bienvenue sur Kallam. Publie ton premier message.</p>
      </article>
    {% endif %}
  </section>

  <aside class="right-rail">
    <div class="rail-card">
      <h3>Profil</h3>
      <dl class="meta-grid">
        <div class="meta-item">
          <dt>Email</dt>
          <dd>{{ user.email }}</dd>
        </div>
        <div class="meta-item">
          <dt>Identifiant</dt>
          <dd>@{{ user.username }}</dd>
        </div>
      </dl>
    </div>

    <div class="rail-card">
      <h3>Tendances</h3>
      <ul class="trends">
        <li>#Kallam</li>
        <li>#SocialApp</li>
        <li>#Privacy</li>
      </ul>
    </div>
  </aside>
</section>
{% endblock %}
